<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test Session</title>
</head>
<body>

<p>
  При включении Session Managment всегда сначала нужно сделать инициализацию SDK.
  <button id="init" >Init the SDK</button>
</p>

<p>
  После можно сделать запрос (автоматичеси создаётся сессия с READ правами)
  <button id="send_request" >Send a request without user logged</button>
</p>

<p>
  Авторизация пользотелем
  <button id="login" >Login</button>
</p>

<p>
  Послать запрос юзером
  <button id="send_request_logged" >Send a request as user</button>
</p>

<button id="logout" >Logout</button>

<!-- 
<button id="destroy_session" type="button">Destroy the session</button>
 -->
<script src="../quickblox.min.js"></script>

<script>
'use strict';

// https://adminstage3.quickblox.com/apps/51091/
var creds = {
  appId: 51092,
  authKey: 'f9pjsfBgXFtGw9D',
  authSecret: '54djY7yK8DeNHJA',
};

var config = {
  sessionManagement: {
    enable: false,
    onerror: function() {
      console.error('SDK can\'t reestablish a session. Check out the Internet connection.');
    },
    expiredTime: 3 // im min.
  },
  debug: {
    mode: 1
  },
  endpoints: {
    api: 'apistage3.quickblox.com',
    chat: 'chatstage3.quickblox.com',
    muc: 'muc.chatstage3.quickblox.com'
  },
};


// login sessionmanagment
// id 22039293
var userParams = {
    email: '1sessionmanagment@test.com',
    password: '49249sessionmanagment'
};

var timerId;
var timeSec;

function startTimer() {
  timerId = setInterval(function() {
    ++timeSec;
    console.log('Log every second, now is', timeSec);
  }, 1000);
}

function finishTimer() {
  clearInterval(timerId);
  timeSec = 0;
};

var init = document.getElementById('init');

/* INIT */
init.addEventListener('click', function(e) {
  e.preventDefault();

  QB.init(creds.appId, creds.authKey, creds.authSecret, config);
});

var sendRequest = document.getElementById('send_request');
sendRequest.addEventListener('click', function(e) {
  e.preventDefault();

  finishTimer();
  startTimer();

  QB.users.listUsers(function(err, res){
    console.info('Get list of user FFFFFF', err, res);
  });
});

var login = document.getElementById('login');
login.addEventListener('click', function(e) {
  e.preventDefault();

  finishTimer();
  startTimer();

  QB.login(userParams, function(err, res) {
    console.info('LOGIN Callback', err, res);
  });
});

var sendRequestLogged = document.getElementById('send_request_logged');
sendRequestLogged.addEventListener('click', function(e) {
    e.preventDefault();

    finishTimer();
    startTimer();

    QB.chat.dialog.list(null, function(err, resDialogs) {
        err ? console.error(err) : console.info(resDialogs);
    });

    return false;
});

var logout = document.getElementById('logout');

// LOGOUT
logout.addEventListener('click', function(e) {
    e.preventDefault();

    finishTimer();
    startTimer();

    QB.logout(function(err, result) {
        console.log('LOGIN Callback', result, err);
    });

    return false;
});
</script>
</body>
</html>
